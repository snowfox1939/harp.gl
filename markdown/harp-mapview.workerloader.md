<!-- Do not edit this file. It is automatically generated by API Documenter. -->

[Home](./index.md) &gt; [@here/harp-mapview](./harp-mapview.md) &gt; [WorkerLoader](./harp-mapview.workerloader.md)

## WorkerLoader class

Set of `Worker` loading and initialization helpers: - starting Worker from URL with fallback to XHR+blob \[\[WorkerLoader.startWorker\]\] - waiting for proper worker initialization, see \[\[WorkerLoader.waitWorkerInitialized\]\]

<b>Signature:</b>

```typescript
export declare class WorkerLoader 
```

## Properties

|  Property | Modifiers | Type | Description |
|  --- | --- | --- | --- |
|  [dependencyUrlMapping](./harp-mapview.workerloader.dependencyurlmapping.md) | <code>static</code> | { \[name: string\]: string; } |  |
|  [directlyFallbackToBlobBasedLoading](./harp-mapview.workerloader.directlyfallbacktoblobbasedloading.md) | <code>static</code> | boolean |  |
|  [sourceLoaderCache](./harp-mapview.workerloader.sourceloadercache.md) | <code>static</code> | Map&lt;string, Promise&lt;string&gt;&gt; |  |

## Methods

|  Method | Modifiers | Description |
|  --- | --- | --- |
|  [fetchScriptSourceToBlobUrl(scriptUrl)](./harp-mapview.workerloader.fetchscriptsourcetobloburl.md) | <code>static</code> | Fetch script source as <code>Blob</code> url.<!-- -->Reuses results, if there are many simultaneous requests. |
|  [startWorker(scriptUrl, timeout)](./harp-mapview.workerloader.startworker.md) | <code>static</code> | Starts worker by first attempting load from <code>scriptUrl</code> using native <code>Worker</code> constructor. Then waits (using \[\[waitWorkerInitialized\]\]) for first message that indicates successful initialization. If <code>scriptUrl</code>'s origin is different than <code>baseUrl</code>, then in case of error falls back to \[\[startWorkerBlob\]\].<!-- -->We must resolve/reject promise at some time, so it is expected that any sane application will be able to load worker code in some amount of time. By default, this method timeouts after 10 seconds (configurable using <code>timeout</code> argument).<!-- -->This method is needed as browsers in general forbid to load worker if it's not on 'same origin' regardless of Content-Security-Policy.<!-- -->For blob-based fallback work, one need to ensure that Content Security Policy (CSP) allows loading web worker code from <code>Blob</code>s. By default browsers, allow 'blob:' for workers, but this may change.<!-- -->Following snippet setups CSP, so workers can be started from blob urls:<head> <meta http-equiv="Content-Security-Policy" content="child-src blob:"> </head>Tested on: \* Chrome 67 / Linux, Window, OSX, Android \* Firefox 60 / Linux, Windows, OSX \* Edge 41 / Windows \* Safari 11 / OSX \* Samsung Internet 7.2<!-- -->See \* https://benohead.com/cross-domain-cross-browser-web-workers/ \* MapBox \* https://stackoverflow.com/questions/21913673/execute-web-worker-from-different-origin \* https://github.com/mapbox/mapbox-gl-js/issues/2658 \* https://github.com/mapbox/mapbox-gl-js/issues/559 \* https://github.com/mapbox/mapbox-gl-js/issues/6058<!-- -->Findings:<!-- -->\* Chrome reports CSP by exception when constructing \[\[Worker\]\] instance. \* Firefox reports CSP errors when loading in first event: https://bugzilla.mozilla.org/show\_bug.cgi?id=1241888 \* Firefox 62, Chrome 67 obeys <code>&lt;meta http-equiv=&quot;Content-Security-Policy&quot;&gt;</code> with <code>worker-src blob:</code> but doesn't obey <code>worker-src URL</code> when used \* Chrome 67 doesn't obey CSP <code>worker-src URL</code> despite it's documented as supported (https://developer.mozilla.org/docs/Web/HTTP/Headers/Content-Security-Policy/worker-src) |
|  [startWorkerBlob(scriptUrl, timeout)](./harp-mapview.workerloader.startworkerblob.md) | <code>static</code> | Start worker "via blob" by first loading worker script code with \[\[fetch\]\], creating <code>Blob</code> and attempting to start worker from blob url. Waits (using \[\[waitWorkerInitialized\]\]) for successful worker start. |
|  [startWorkerImmediately(scriptUrl, timeout)](./harp-mapview.workerloader.startworkerimmediately.md) | <code>static</code> | Start worker, loading it immediately from <code>scriptUrl</code>. Waits (using \[\[waitWorkerInitialized\]\]) for successful worker start. |
|  [waitWorkerInitialized(worker, timeout)](./harp-mapview.workerloader.waitworkerinitialized.md) | <code>static</code> | Waits for successful Web Worker start.<!-- -->Expects that worker script sends initial message.<!-- -->If first event is <code>message</code> then assumes that worker has been loaded sussesfully and promise resolves to <code>worker</code> object passed as argument.<!-- -->If first event is 'error', then it is assumed that worker failed to load and promise is rejected.<!-- -->(NOTE: The initial 'message' - if received - is immediately replayed using worker's <code>dispatchEvent</code>, so application code can also consume it as confirmation of successful worker initialization.<!-- -->We must resolve/reject promise at some time, so it is expected that any sane application will be able to load worker code in some amount of time. |

